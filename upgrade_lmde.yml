---
- name: Upgrade LMDE 6 to LMDE 7
  hosts: all
  become: yes
  tasks:

    - name: Update package lists
      apt:
        update_cache: yes
        cache_valid_time: 3600  # 1 hour

    - name: Upgrade all packages
      apt:
        upgrade: dist

    - name: Remove unnecessary packages
      apt:
        autoremove: yes
        autoclean: yes

    - name: Backup official-package-repositories.list
      command: cp /etc/apt/sources.list.d/official-package-repositories.list /etc/apt/sources.list.d/official-package-repositories.list.bak

    - name: Update official-package-repositories.list for LMDE 7
      blockinfile:
        path: /etc/apt/sources.list.d/official-package-repositories.list
        block: |
          # Do not edit this file manually, use Software Sources instead.
          
          deb http://packages.linuxmint.com gigi main upstream import backport #id:linuxmint_main
          
          deb https://deb.debian.org/debian trixie main contrib non-free non-free-firmware
          deb https://deb.debian.org/debian trixie-updates main contrib non-free non-free-firmware
          deb http://security.debian.org trixie-security main contrib non-free non-free-firmware
          
    - name: Update package cache
      apt:
        update_cache: yes

    - name: Upgrade installed packages to LMDE 7
      apt:
        upgrade: dist

    - name: Remove unnecessary packages
      apt:
        autoremove: yes
    
